# i18n Guide for Astrowind

## Overview

Astrowind uses a hybrid i18n system:

- **Astro native routing** for locale‑prefixed URLs (`/[locale]/...`)
- **Wuchale** for compile‑time string extraction and translation (`.po` files)
- **Content collections** for localized blog posts (`src/data/post/[locale]/`)
- **Virtual module** `astrowind:config` for configuration

## Key Files

- `src/config.yaml` – i18n settings (locales, defaultLocale, localeNames)
- `astro.config.ts` – Astro i18n routing configuration
- `wuchale.config.js` – Wuchale extraction configuration
- `src/utils/i18n.ts` – Core i18n utilities (use `getCurrentLocale()`)
- `src/utils/permalinks.ts` – Permalink generation (auto‑detects locale)

## Rules for Developers

### 1. Use `getPermalink()` Without Explicit Locale

**Wrong**: `getPermalink(post.permalink, 'post', currentLocale)`
**Right**: `getPermalink(post.permalink, 'post')` – locale auto‑detected

### 2. Never Hardcode Locale Prefixes

**Wrong**: `<a href="/en/blog">`
**Right**: `<a href={getPermalink('blog', 'blog')}>`

### 3. Use `getCurrentLocale()` for Display

```astro
---
import { getCurrentLocale } from '~/utils/i18n';
const locale = getCurrentLocale();
---

<p>Current locale: {locale}</p>
```

### 4. Adding a New Locale

1. Add locale code to `src/config.yaml` `i18n.locales`.
2. Create `src/data/post/[new‑locale]/` directory for blog posts.
3. Run `bun run dev` – Wuchale will generate `.po` files.
4. Translate strings (or use Gemini auto‑translation).

### 5. Troubleshooting

- **Missing locale prefix**: Ensure you're not passing `undefined` as locale (use auto‑detect).
- **"Astro is not defined"**: Already fixed in `getCurrentLocale()`.
- **Wuchale not extracting**: Check `wuchale.config.js` heuristic.

## Migration from Old Patterns

Replace `getPermalink(..., ..., locale)` with `getPermalink(...)`.
Remove `getCurrentLocale()` imports where only used for permalinks.
